<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
    <title>Monitor de Ping</title>
</head>
<header class="d-flex justify-content-center align-items-center">
    <img class="logo" src="assets/img/logo.png" alt="Logo Conecta">
    <h1 class="titulo-pagina d-flex justify-content-center">Monitor de Ping</h1>
</header>

<body>
    <section class="altura-total">
        <div class="d-flex justify-content-center" id="results"></div>
    </section>
    <footer class="d-flex justify-content-center">
        <h5>Criado por Weslei Almeida Muniz</h5>
    </footer>

    <script>

        const hosts = {
            impressora: ['google.com', '192.168.1.102', 'facebook.com.br'],
            pc: ['192.168.1.101'],
            servidor: ['itch.io']
        };

        async function checkPing(selectedHosts) {
            const response = await fetch(`/ping?hosts=${selectedHosts.join(',')}`);
            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error || 'Erro desconhecido');
            }
            return response.json();
        }


        function displayPing(results) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = ''; // Limpa resultados anteriores

            results.forEach(result => {
                const card = document.createElement('div');
                card.className = 'card';

                const deviceContainer = document.createElement('div');
                deviceContainer.className = 'device-container';

                // Sinalizador de status
                const statusIndicator = document.createElement('img');
                statusIndicator.className = 'status-indicator';
                statusIndicator.src = result.time !== 'Inativo' ? `assets/img/${result.type}_online.png` : `assets/img/${result.type}_offline.png`; // Caminhos para as imagens

                const resultText = document.createElement('div');
                resultText.textContent = `Host: ${result.host} - Ping: ${result.time || result.error}`;

                deviceContainer.appendChild(statusIndicator);
                deviceContainer.appendChild(resultText);
                card.appendChild(deviceContainer);
                resultsDiv.appendChild(card); // Adiciona cada card ao resultado
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            setInterval(async () => {
                const allHosts = [];
                for (const key in hosts) {
                    allHosts.push(...hosts[key]); // Adiciona todos os hosts ao array
                }

                try {
                    const results = await checkPing(allHosts); // Faz o ping em todos os hosts
                    const detailedResults = results.map((result, index) => ({
                        host: allHosts[index], // Associa o host ao resultado
                        time: result.time,
                        type: Object.keys(hosts).find(key => hosts[key].includes(allHosts[index])) // Obt√©m o tipo de dispositivo
                    }));
                    displayPing(detailedResults);
                } catch (error) {
                    displayPing([{ host: 'Erro', time: error.message }]);
                }
            }, 3000); // A cada 3 segundos
        });

    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

</body>

</html>