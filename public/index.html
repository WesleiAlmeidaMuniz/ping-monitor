<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="style.css" />
    <link rel="shortcut icon" href="assets/img/logo.png" type="image/x-icon" />
    <title>Conecta PING</title>
  </head>
  <header class="d-flex justify-content-center align-items-center">
    <img class="logo" src="assets/img/logo.png" alt="Logo Conecta" />
    <h1 class="titulo-pagina d-flex justify-content-center">Conecta PING</h1>
  </header>

  <body>
    <section class="altura-total">
      <h1>Impressoras</h1>
      <div
        class="d-flex justify-content-center flex-wrap"
        id="results-imp"
      ></div>
      <hr />
      <h1>Câmeras</h1>
      <section>
        <h5>DVR1</h5>
        <div
          class="d-flex justify-content-center flex-wrap"
          id="results-cam1"
        ></div>
        <hr />
      </section>
      <section>
        <h5>DVR2</h5>
        <div
          class="d-flex justify-content-center flex-wrap"
          id="results-cam2"
        ></div>
        <hr />
      </section>
      <section>
        <h5>DVR3</h5>
        <div
          class="d-flex justify-content-center flex-wrap"
          id="results-cam3"
        ></div>
      </section>
      <hr />
      <h1>Ramal</h1>
      <div
        class="d-flex justify-content-center flex-wrap"
        id="results-tel"
      ></div>
    </section>
    <footer class="d-flex justify-content-center">
      <h5>Criado por T.I - Infra</h5>
    </footer>

    <script>
      const DVR1 = "DVR1";
      const DVR2 = "DVR2";
      const DVR3 = "DVR3";

      const hosts = {
        impressora: [
          "192.168.0.12",
          "192.168.0.13",
          "192.168.7.249",
          "192.168.7.255",
          "192.168.8.19",
          "192.168.15.225",
          "192.168.7.243",
          "192.168.7.239",
          "192.168.0.21",
          "192.168.0.55",
        ],
        camera: [
          "192.168.1.177",
          "192.168.1.176",
          "192.168.1.175",
          "192.168.1.173",
          "192.168.1.172",
          "192.168.1.171",
          "192.168.1.2",
          "192.168.1.178",
          "192.168.1.179",
          "192.168.1.180",
          "192.168.1.181",
          "192.168.1.182",
          "192.168.1.183",
          "192.168.1.231",
          "192.168.1.185",
          "192.168.1.24",
          "192.168.1.162",
          "192.168.1.45",
          "192.168.1.216",
          "192.168.1.217",
          "192.168.1.218",
          "192.168.1.220",
          "192.168.1.223",
          "192.168.1.215",
          "192.168.1.227",
          "192.168.1.232",
          "192.168.1.228",
          "192.168.1.235",
          "192.168.1.236",
          "192.168.1.237",
          "192.168.1.200",
          "192.168.1.201",
          "192.168.1.202",
          "192.168.1.203",
          "192.168.1.204",
          "192.168.1.205",
          "192.168.1.206",
          "192.168.1.208",
          "192.168.1.209",
          "192.168.1.210",
          "192.168.1.211",
          "192.168.1.212",
          "192.168.1.213",
          "192.168.1.214",
        ],
        ramal: [
          "192.168.15.16",
          "192.168.8.10",
          "192.168.8.3",
          "192.168.15.223",
          "192.168.8.2",
          "192.168.2.10",
          "192.168.8.142",
          "192.168.15.19",
        ],
      };

      async function checkPing(selectedHosts) {
        const response = await fetch(`/ping?hosts=${selectedHosts.join(",")}`);
        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.error || "Erro desconhecido");
        }
        return response.json();
      }

      function displayPing(results) {
        const resultsDivImp = document.getElementById("results-imp");
        const resultsDivCam1 = document.getElementById("results-cam1");
        const resultsDivCam2 = document.getElementById("results-cam2");
        const resultsDivCam3 = document.getElementById("results-cam3");
        const resultsDivTel = document.getElementById("results-tel");
        resultsDivImp.innerHTML = "";
        resultsDivCam1.innerHTML = "";
        resultsDivCam2.innerHTML = "";
        resultsDivCam3.innerHTML = "";
        resultsDivTel.innerHTML = "";

        results.forEach((result) => {
          const card = document.createElement("div");
          card.className = "card";

          const deviceContainer = document.createElement("div");
          deviceContainer.className = "device-container";

          // Sinalizador de status
          const statusIndicator = document.createElement("img");
          statusIndicator.className = "status-indicator";
          statusIndicator.src =
            result.time !== "Inativo"
              ? `assets/img/${result.type}_online.png`
              : `assets/img/${result.type}_offline.png`; // Caminhos para as imagens

          const IpHostName = document.createElement("div");
          if (result.type === "impressora" || result.type === "ramal") {
            IpHostName.textContent = HostIP(result.host);
            IpHostName.className = "HostName";
          } else {
            IpHostName.textContent = result.host;
            IpHostName.className = "HostName";
          }

          /*
                const containerDados = document.createElement('div');
                containerDados.className = 'container-dados';

                const resultTextHost = document.createElement('div');
                resultTextHost.innerHTML = `Host: <br> ${result.host}`;

                const resultTextIP = document.createElement('div');
                resultTextIP.innerHTML = `Ping: <Br> ${result.time || result.error}`;
                */

          deviceContainer.appendChild(statusIndicator);
          deviceContainer.appendChild(IpHostName);
          //containerDados.appendChild(resultTextHost);
          //containerDados.appendChild(resultTextIP);
          //deviceContainer.appendChild(containerDados);
          card.appendChild(deviceContainer);
          if (result.type === "impressora") {
            resultsDivImp.appendChild(card); // Adiciona cada card ao resultado Impressora
          } else if (result.type === "camera") {
            if (HostIP(result.host) === "DVR1") {
              resultsDivCam1.appendChild(card);
            } else if (HostIP(result.host) === "DVR2") {
              resultsDivCam2.appendChild(card);
            } else if (HostIP(result.host) === "DVR3") {
              resultsDivCam3.appendChild(card);
            }
          } else if (result.type === "ramal") {
            resultsDivTel.appendChild(card); // Adiciona cada card ao resultado Ramal
          }
        });
      }

      document.addEventListener("DOMContentLoaded", () => {
        setInterval(async () => {
          const allHosts = [];
          for (const key in hosts) {
            allHosts.push(...hosts[key]); // Adiciona todos os hosts ao array
          }

          try {
            const results = await checkPing(allHosts); // Faz o ping em todos os hosts
            const detailedResults = results.map((result, index) => ({
              host: allHosts[index], // Associa o host ao resultado
              time: result.time,
              type: Object.keys(hosts).find((key) =>
                hosts[key].includes(allHosts[index])
              ), // Obtém o tipo de dispositivo
            }));
            displayPing(detailedResults);
          } catch (error) {
            displayPing([{ host: "Erro", time: error.message }]);
          }
        }, 10000); // A cada 10 segundos
      });

      function HostIP(ip) {
        const iphost = {
          "192.168.0.12": "RH BP",
          "192.168.0.13": "RH COLOR",
          "192.168.7.249": "Financeiro",
          "192.168.7.255": "Armazen",
          "192.168.8.19": "Torre1",
          "192.168.15.225": "Torre2",
          "192.168.7.243": "SAC",
          "192.168.7.239": "Pendencia",
          "192.168.0.21": "Transferência",
          "192.168.0.55": "Recebimento",
          "192.168.15.16": "RH 200",
          "192.168.8.10": "SAC 201",
          "192.168.8.3": "SAC 202",
          "192.168.15.223": "Financeiro 203",
          "192.168.8.2": "SAC 204",
          "192.168.2.10": "Comercial 205",
          "192.168.8.142": "Torre 207",
          "192.168.15.19": "Pendencia 208",
          "192.168.1.2": DVR1,
          "192.168.1.171": DVR1,
          "192.168.1.172": DVR1,
          "192.168.1.173": DVR1,
          "192.168.1.175": DVR1,
          "192.168.1.176": DVR1,
          "192.168.1.177": DVR1,
          "192.168.1.178": DVR1,
          "192.168.1.179": DVR1,
          "192.168.1.180": DVR1,
          "192.168.1.181": DVR1,
          "192.168.1.182": DVR1,
          "192.168.1.183": DVR1,
          "192.168.1.185": DVR1,
          "192.168.1.231": DVR1,
          "192.168.1.24": DVR2,
          "192.168.1.162": DVR2,
          "192.168.1.45": DVR2,
          "192.168.1.216": DVR2,
          "192.168.1.217": DVR2,
          "192.168.1.218": DVR2,
          "192.168.1.220": DVR2,
          "192.168.1.223": DVR2,
          "192.168.1.215": DVR2,
          "192.168.1.227": DVR2,
          "192.168.1.232": DVR2,
          "192.168.1.228": DVR2,
          "192.168.1.235": DVR2,
          "192.168.1.236": DVR2,
          "192.168.1.237": DVR2,
          "192.168.1.200": DVR3,
          "192.168.1.201": DVR3,
          "192.168.1.202": DVR3,
          "192.168.1.203": DVR3,
          "192.168.1.204": DVR3,
          "192.168.1.205": DVR3,
          "192.168.1.206": DVR3,
          "192.168.1.208": DVR3,
          "192.168.1.209": DVR3,
          "192.168.1.210": DVR3,
          "192.168.1.211": DVR3,
          "192.168.1.212": DVR3,
          "192.168.1.213": DVR3,
          "192.168.1.214": DVR3,
        };

        return iphost[ip];
      }
    </script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
